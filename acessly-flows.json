[{"id":"ebe600cab6ea8952","type":"tab","label":"Flow 2","disabled":false,"info":"","env":[]},{"id":"68407fa35614ff8a","type":"mqtt in","z":"ebe600cab6ea8952","name":"MQTT Acessly","topic":"/acessly/empresa/001/data","qos":"0","datatype":"utf8","broker":"1aba507221ee4cfc","nl":false,"rap":true,"rh":0,"inputs":0,"x":600,"y":260,"wires":[["e99559d69152880d"]]},{"id":"e99559d69152880d","type":"json","z":"ebe600cab6ea8952","name":"","property":"payload","action":"obj","pretty":false,"x":790,"y":260,"wires":[["d0bf6b4dc99329ac","d0e15ee45d29b82a","f00b6302f649d4c2","cbbe7c8af010cad4","cbf789b998c3c1ee"]]},{"id":"d0bf6b4dc99329ac","type":"function","z":"ebe600cab6ea8952","name":"Separar Dados","func":"//verifica se payload foi convertido para objeto\nif (typeof msg.payload === 'string') {\n    node.error(\"Payload ainda Ã© string! JSON nÃ£o foi parseado.\", msg);\n    return null;\n}\n\n//verifica se as propriedades existem\nif (!msg.payload.accessibility) {\n    node.error(\"Propriedade 'accessibility' nÃ£o encontrada no payload\", msg);\n    return null;\n}\n\nif (!msg.payload.sensors) {\n    node.error(\"Propriedade 'sensors' nÃ£o encontrada no payload\", msg);\n    return null;\n}\n\n//extrai os dados do payload\nlet score = msg.payload.accessibility.score;\nlet status = msg.payload.accessibility.status;\nlet temp = msg.payload.sensors.temperature;\nlet light = msg.payload.sensors.light_level;\nlet noise = msg.payload.sensors.noise_level;\n\n//cria 3 saÃ­das separadas\nreturn [\n    { payload: score },                                      // SaÃ­da 1: gauge\n    { payload: { temp: temp, light: light, noise: noise } }, // SaÃ­da 2: chart\n    { payload: status }                                      // SaÃ­da 3: text\n];\n","outputs":3,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1020,"y":280,"wires":[["8e606894f8b81b1c"],["3a97ec3d7c59c606"],["c5136d583a3bb70d"]]},{"id":"8e606894f8b81b1c","type":"ui_gauge","z":"ebe600cab6ea8952","name":"","group":"c79924e8485b33fb","order":2,"width":"12","height":"5","gtype":"donut","title":"Score de Acessibilidade","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#ca3838","#e6e600","#00a300"],"seg1":"50","seg2":"80","diff":false,"className":"","x":1370,"y":180,"wires":[]},{"id":"7835661ddaf3e67d","type":"ui_chart","z":"ebe600cab6ea8952","name":"GrÃ¡fico Sensores Ambientais","group":"fd5b10da6789130a","order":1,"width":"14","height":"14","label":"GrÃ¡fico de Sensores Ambientais","chartType":"line","legend":"true","xformat":"Tempo","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"10","removeOlderPoints":"","removeOlderUnit":"60","cutout":0,"useOneColor":false,"useUTC":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"outputs":1,"useDifferentColor":false,"className":"","x":1700,"y":260,"wires":[[]]},{"id":"3a97ec3d7c59c606","type":"function","z":"ebe600cab6ea8952","name":"Preparar SÃ©ries do GrÃ¡fico","func":"//separa os 3 valores em mensagens individuais para o grÃ¡fico\nreturn [\n    { payload: msg.payload.temp, topic: \"Temperatura (Â°C)\" },\n    { payload: msg.payload.light, topic: \"Luminosidade\" },\n    { payload: msg.payload.noise, topic: \"RuÃ­do\" }\n];\n","outputs":3,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1380,"y":260,"wires":[["7835661ddaf3e67d"],["7835661ddaf3e67d"],["7835661ddaf3e67d"]]},{"id":"d0e15ee45d29b82a","type":"debug","z":"ebe600cab6ea8952","name":"Debug MQTT","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1020,"y":120,"wires":[]},{"id":"b24a6e44338c58fa","type":"comment","z":"ebe600cab6ea8952","name":"RecepÃ§Ã£o De Dados MQTT","info":"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ“¡ RECEPÃ‡ÃƒO DE DADOS MQTT\nRecebe dados JSON do ESP32 via broker test.mosquitto.org\nTÃ³pico: /acessly/empresa/001/data\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•","x":640,"y":200,"wires":[]},{"id":"76680c2338dcfd7b","type":"comment","z":"ebe600cab6ea8952","name":"Processamento","info":"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâš™ï¸ PROCESSAMENTO DE DADOS\nExtrai e formata os dados dos sensores para os widgets\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n","x":1020,"y":200,"wires":[]},{"id":"cc77fcdc9e14eace","type":"comment","z":"ebe600cab6ea8952","name":"Dashboard","info":"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nğŸ“Š DASHBOARD - VISUALIZAÃ‡ÃƒO\nExibe score, grÃ¡fico de sensores e status do ambiente\nAcesse em: http://localhost:1880/ui\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n","x":1320,"y":100,"wires":[]},{"id":"c5136d583a3bb70d","type":"ui_template","z":"ebe600cab6ea8952","group":"c79924e8485b33fb","name":"Status","order":1,"width":"12","height":"5","format":"<div style=\"display: flex; align-items: center; justify-content: center; height: 100%; background: #2c2c2c; border-radius: 8px; padding: 30px;\">\n    <div style=\"text-align: center;\">\n        <div style=\"font-size: 18px; color: #999; margin-bottom: 50px; font-weight: 600;\">Status do Ambiente</div>\n        <div ng-style=\"{'color': msg.payload === 'OK' ? '#4CAF50' : msg.payload === 'WARNING' ? '#FF9800' : '#F44336', 'font-size': '42px', 'font-weight': 'bold'}\">\n            {{msg.payload}}\n        </div>\n        <div style=\"margin-top: 15px; font-size: 14px; color: #bbb;\">\n            <span ng-if=\"msg.payload === 'OK'\">âœ“ Todas as condiÃ§Ãµes adequadas</span>\n            <span ng-if=\"msg.payload === 'WARNING'\">âš  AtenÃ§Ã£o necessÃ¡ria</span>\n            <span ng-if=\"msg.payload === 'CRITICAL'\">âœ— CondiÃ§Ãµes crÃ­ticas</span>\n        </div>\n    </div>\n</div>\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":1310,"y":340,"wires":[[]]},{"id":"bbb8a3a89d7261aa","type":"ui_template","z":"ebe600cab6ea8952","group":"42472ac0693d8d46","name":"Header","order":1,"width":"26","height":"2","format":"<div\n    style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; text-align: center; color: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\">\n    <h1 style=\"margin: 0; font-size: 28px; font-weight: 700;\">\n        â™¿ Acessly Monitor\n    </h1>\n    <p style=\"margin: 5px 0 0 0; font-size: 14px; opacity: 0.9;\">\n        Monitoramento em Tempo Real de Acessibilidade\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":580,"y":100,"wires":[[]]},{"id":"f00b6302f649d4c2","type":"ui_template","z":"ebe600cab6ea8952","group":"4b963cf493f0c138","name":"Cards","order":1,"width":"26","height":"6","format":"<div style=\"display: flex; justify-content: space-between; padding: 15px; gap: 12px; overflow: visible;\">\n    <!-- Card Temperatura -->\n    <div\n        style=\"flex: 1; min-width: 180px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 25px 15px; text-align: center; color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.3);\">\n        <div style=\"font-size: 42px; margin-bottom: 8px;\">ğŸŒ¡ï¸</div>\n        <div style=\"font-size: 28px; font-weight: bold; margin-bottom: 5px;\">\n            {{msg.payload.sensors.temperature.toFixed(1)}}Â°C</div>\n        <div style=\"font-size: 13px; opacity: 0.95; margin-bottom: 10px; font-weight: 500;\">Temperatura</div>\n        <div\n            style=\"font-size: 11px; padding: 6px 12px; background: rgba(255,255,255,0.25); border-radius: 15px; display: inline-block; font-weight: 600;\">\n            <span ng-if=\"msg.payload.accessibility.compliance.temperature\">âœ… OK</span>\n            <span ng-if=\"!msg.payload.accessibility.compliance.temperature\">âš ï¸ Fora</span>\n        </div>\n    </div>\n\n    <!-- Card Luminosidade -->\n    <div\n        style=\"flex: 1; min-width: 180px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; padding: 25px 15px; text-align: center; color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.3);\">\n        <div style=\"font-size: 42px; margin-bottom: 8px;\">ğŸ’¡</div>\n        <div style=\"font-size: 28px; font-weight: bold; margin-bottom: 5px;\">{{msg.payload.sensors.light_level}}</div>\n        <div style=\"font-size: 13px; opacity: 0.95; margin-bottom: 10px; font-weight: 500;\">Luminosidade</div>\n        <div\n            style=\"font-size: 11px; padding: 6px 12px; background: rgba(255,255,255,0.25); border-radius: 15px; display: inline-block; font-weight: 600;\">\n            <span ng-if=\"msg.payload.accessibility.compliance.lighting\">âœ… Adequada</span>\n            <span ng-if=\"!msg.payload.accessibility.compliance.lighting\">âš ï¸ Baixa</span>\n        </div>\n    </div>\n\n    <!-- Card RuÃ­do -->\n    <div\n        style=\"flex: 1; min-width: 180px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 12px; padding: 25px 15px; text-align: center; color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.3);\">\n        <div style=\"font-size: 42px; margin-bottom: 8px;\">ğŸ”Š</div>\n        <div style=\"font-size: 28px; font-weight: bold; margin-bottom: 5px;\">{{msg.payload.sensors.noise_level}}</div>\n        <div style=\"font-size: 13px; opacity: 0.95; margin-bottom: 10px; font-weight: 500;\">NÃ­vel de RuÃ­do</div>\n        <div\n            style=\"font-size: 11px; padding: 6px 12px; background: rgba(255,255,255,0.25); border-radius: 15px; display: inline-block; font-weight: 600;\">\n            <span ng-if=\"msg.payload.accessibility.compliance.noise\">âœ… AceitÃ¡vel</span>\n            <span ng-if=\"!msg.payload.accessibility.compliance.noise\">âš ï¸ Alto</span>\n        </div>\n    </div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":990,"y":380,"wires":[[]]},{"id":"cbbe7c8af010cad4","type":"function","z":"ebe600cab6ea8952","name":"Detectar Problemas","func":"let problemas = [];\nlet c = msg.payload.accessibility.compliance;\n\n// Verifica cada condiÃ§Ã£o e adiciona Ã  lista\nif (!c.lighting) {\n    problemas.push(\"ğŸ’¡ Luminosidade insuficiente\");\n}\n\nif (!c.noise) {\n    problemas.push(\"ğŸ”Š RuÃ­do excessivo\");\n}\n\nif (!c.path_clear) {\n    problemas.push(\"ğŸš« Caminho obstruÃ­do\");\n}\n\n// Se houver problemas, retorna mensagem\nif (problemas.length > 0) {\n    return {\n        payload: problemas.join(\" | \"),\n        topic: msg.payload.accessibility.score < 50 ? \"warning\" : \"info\"\n    };\n}\n\nreturn null; // NÃ£o envia nada se tudo estiver OK\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1040,"y":480,"wires":[["ac9336f9133a1204"]]},{"id":"ac9336f9133a1204","type":"ui_toast","z":"ebe600cab6ea8952","position":"top right","displayTime":"5","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"className":"","topic":"Aviso","name":"Mostrar notificaÃ§Ã£o","x":1350,"y":480,"wires":[]},{"id":"cbf789b998c3c1ee","type":"ui_template","z":"ebe600cab6ea8952","group":"c79924e8485b33fb","name":"Ambiente","order":3,"width":"7","height":"2","format":"<div\n    style=\"display: flex; align-items: center; justify-content: flex-start; width: 100%; height: 100%; padding-left: 20px;\">\n    <div\n        ng-style=\"{'background': msg.payload.accessibility.score >= 80 ? '#4CAF50' : msg.payload.accessibility.score >= 50 ? '#FF9800' : '#F44336', 'color': 'white', 'padding': '15px 25px', 'border-radius': '8px', 'text-align': 'center', 'font-size': '18px', 'font-weight': 'bold', 'box-shadow': '0 2px 4px rgba(0,0,0,0.2)', 'display': 'inline-block'}\">\n        <span ng-if=\"msg.payload.accessibility.score >= 80\">âœ… Ambiente Adequado</span>\n        <span ng-if=\"msg.payload.accessibility.score >= 50 && msg.payload.accessibility.score < 80\">âš ï¸ AtenÃ§Ã£o NecessÃ¡ria</span>\n        <span ng-if=\"msg.payload.accessibility.score < 50\">ğŸš¨ SituaÃ§Ã£o CrÃ­tica</span>\n    </div>\n</div>","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":true,"templateScope":"local","className":"","x":1000,"y":40,"wires":[[]]},{"id":"f3d8b09c2536763f","type":"ui_spacer","z":"ebe600cab6ea8952","name":"spacer","group":"c79924e8485b33fb","order":4,"width":6,"height":1},{"id":"1aba507221ee4cfc","type":"mqtt-broker","name":"","broker":"broker.hivemq.com","port":"1883","clientid":"","autoConnect":true,"usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"autoUnsubscribe":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closeRetain":"false","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willRetain":"false","willPayload":"","willMsg":{},"userProps":"","sessionExpiry":""},{"id":"c79924e8485b33fb","type":"ui_group","name":"Resumo","tab":"fb922d657ec8e295","order":3,"disp":false,"width":"12","collapse":false,"className":""},{"id":"fd5b10da6789130a","type":"ui_group","name":"Monitoramento Ambiental","tab":"fb922d657ec8e295","order":4,"disp":false,"width":"14","collapse":false,"className":""},{"id":"42472ac0693d8d46","type":"ui_group","name":"Header","tab":"fb922d657ec8e295","order":1,"disp":false,"width":"26","collapse":false,"className":""},{"id":"4b963cf493f0c138","type":"ui_group","name":"Sensores","tab":"fb922d657ec8e295","order":5,"disp":true,"width":"26","collapse":false,"className":""},{"id":"fb922d657ec8e295","type":"ui_tab","name":"Acessly Monitor","icon":"dashboard","order":4,"disabled":false,"hidden":false}]